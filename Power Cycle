{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "PowerCyclingTest",
  "type": "object",
  "required": ["test_id", "name", "targets", "steps", "expected_outcome", "metadata"],
  "properties": {
    "test_id": {
      "type": "string",
      "description": "Unique identifier for this test case"
    },
    "name": {
      "type": "string",
      "description": "Human-friendly test name"
    },
    "description": {
      "type": "string",
      "description": "Longer description of goal and scope"
    },
    "tags": {
      "type": "array",
      "items": { "type": "string" }
    },
    "metadata": {
      "type": "object",
      "properties": {
        "author": { "type": "string" },
        "created_at": { "type": "string", "format": "date-time" },
        "priority": { "type": "string", "enum": ["P0","P1","P2","P3"] },
        "version": { "type": "string" }
      },
      "additionalProperties": true
    },
    "targets": {
      "type": "array",
      "description": "List of target devices / systems to power-cycle",
      "items": {
        "type": "object",
        "required": ["name", "id", "interface"],
        "properties": {
          "name": { "type": "string" },
          "id": { "type": "string" },
          "interface": {
            "type": "object",
            "properties": {
              "type": { "type": "string", "enum": ["IPMI","Redfish","RackManager","Serial","GPIO","PDU","Custom"] },
              "endpoint": { "type": "string" },
              "credentials_id": { "type": "string" },
              "options": { "type": "object" }
            },
            "required": ["type"]
          },
          "expected_power_state": { "type": "string", "enum": ["on","off","unknown"] }
        },
        "additionalProperties": true
      }
    },
    "preconditions": {
      "type": "array",
      "items": { "type": "string" }
    },
    "steps": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["step_number", "action"],
        "properties": {
          "step_number": { "type": "integer" },
          "action": { "type": "string" },
          "command": { "type": "string" },
          "args": { "type": "object" },
          "target_ids": {
            "type": "array",
            "items": { "type": "string" },
            "description": "IDs from targets to apply this step to"
          },
          "timeout_seconds": { "type": "integer", "minimum": 0 },
          "retry": {
            "type": "object",
            "properties": {
              "count": { "type": "integer", "minimum": 0 },
              "interval_seconds": { "type": "integer", "minimum": 0 }
            }
          },
          "expect": { "type": "string" },
          "notes": { "type": "string" }
        },
        "additionalProperties": true
      }
    },
    "expected_outcome": {
      "type": "object",
      "properties": {
        "power_state": { "type": "string", "enum": ["on","off","rebooted","unchanged","unknown"] },
        "service_availability": { "type": "string" },
        "max_boot_time_seconds": { "type": "integer" }
      },
      "additionalProperties": true
    },
    "metrics": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "name": { "type": "string" },
          "description": { "type": "string" },
          "unit": { "type": "string" }
        }
      }
    },
    "artifacts": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "type": { "type": "string" },
          "path": { "type": "string" },
          "description": { "type": "string" }
        }
      }
    },
    "notifications": {
      "type": "object",
      "properties": {
        "on_failure": { "type": "array", "items": { "type": "string" } },
        "on_success": { "type": "array", "items": { "type": "string" } }
      }
    },
    "cleanup": {
      "type": "array",
      "items": { "type": "string" }
    }
  },
  "additionalProperties": false
}
